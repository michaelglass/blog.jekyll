<!doctype html>
<!--[if lt IE 7 ]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]>	   <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]>	   <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>Introducing PubSubJS, a Library for doing publish/subscribe in JavaScript | roderick.dk</title>
		
		<meta name="author" content="Morgan Roderick" />

		<!-- Mobile viewport optimized: j.mp/bplateviewport -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<!-- CSS: implied media="all" -->
		<link rel="stylesheet" href="/stylesheets/style.css?v=2" />

		<!-- Place favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="apple-touch-icon" href="/apple-touch-icon.png" />
	</head>
	<body>
	  <div id="container">
		<header>
			<a href="/" class="home">roderick.dk</a>
			<ul class="nav">
				<li><a href="/">Blog</a></li>
				<li><a href="/archives.html">Archives</a></li>
				<li><a href="/about/">About</a></li>
				<li><a href="/contact/">Contact</a></li>
			</ul>
			<a href="/atom.xml" class="feed">Subscribe to the feed</a>
		</header>
		<div id="main" role="main">
			<div class="article">
	<article>
		<h1>Introducing PubSubJS, a Library for doing publish/subscribe in JavaScript</h1>
		<p>For quite a while, I have been working on a large web application for a client. For <a href='http://en.wikipedia.org/wiki/Publish/subscribe'>publish/subscribe</a> style messaging in the web frontend, we use jQuery custom events triggered on the body element. This is quite a neat trick to ensure loose coupling of modules, since you&#8217;re really just tracking what the user does, and not what module happened to generate the message.</p>

<p>This approach has been introduced to my team by me, and I have been very eager to help my team mates understand how to use it.</p>

<p>I have been so satisfied with this approach, that I&#8217;ve even given a talk about it the <a href='http://groups.google.com/group/js-berlin'>JS Berlin meetup</a>. Others have also been quite taken with this approach, some are listed in the footnotes.</p>

<p>Recently, I&#8217;ve become less and less satisfied with this approach.</p>

<p>One of the problems you eventually will run into with using jQuery custom events for publish/subscribe, is that they&#8217;re syncronous, so you will end up triggering new events, before you&#8217;re done executing the handlers for the current event.</p>

<p>It get&#8217;s messy, trust me.</p>

<h2 id='so_why_a_new_library'>So why a new library?</h2>

<p>Well, there are actually a number of reasons, that ultimately led me to look for a better way of doing publish/subscribe messaging in &#8220;JavaScript&#8221;:https://developer.mozilla.org/en/JavaScript.</p>

<p>I wanted something that would meet most of these requirements:</p>

<ul>
<li>Published under a reasonable software license ( CC, MIT, BSD, Apache, WTFPL, etc)</li>

<li>All messages should be passed async be default, anything else is just confusing</li>

<li>No use of DOM (it&#8217;s slow, and storing state in something you have no control over is silly)</li>

<li>Pure &#8220;JavaScript&#8221;:https://developer.mozilla.org/en/JavaScript, no library dependencies</li>

<li>No side-effects, jQuery modifies subscribers (adding an &#8220;id&#8221; property to the functions)</li>

<li>Should be able to run outside browsers</li>

<li>Should have up to date documentation (or at least aligned with the codebase)</li>

<li>Tests are important, ok?</li>

<li>Small(ish)</li>
</ul>

<p>Well, it turned out that my searches on the internet came up empty (my Google-fu could be better), so I decided to write an implementation myself. I call it <a href='http://github.com/mroderick/PubSubJS'>PubSubJS</a>.</p>

<p>I&#8217;ve published it at <a href='http://github.com/mroderick/PubSubJS'>http://github.com/mroderick/PubSubJS</a>, you could take it for a spin, run the tests if you like, even fork it and contribute to it.</p>

<h2 id='so_what_can_this_pubsubjs_do'>So what can this PubSubJS do?</h2>

<p>Not a lot.</p>

<p>Basically, you can subscribe to messages, publish messages (with a payload) and unsubscribe from messages. If you&#8217;re feeling adventurous (or really believe that you have 100% understanding of the consequences), you can also force message publication to be syncronous.</p>

<p>Let&#8217;s see some code already!</p>
<div class='highlight'><pre><code class='javascript'><span class='c1'>// subscribing to messages is quite easy,</span>
<span class='c1'>// first we&#39;ll create a subscriber function</span>
<span class='kd'>var</span> <span class='nx'>logToConsole</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>(</span> <span class='nx'>message</span><span class='p'>,</span> <span class='nx'>data</span> <span class='p'>){</span>
    <span class='c1'>// once a message arrives, it&#39;ll get logged to the console</span>
    <span class='c1'>// data passed in messages can be whatever you want</span>
    <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span> <span class='nx'>message</span><span class='p'>,</span> <span class='nx'>data</span> <span class='p'>);</span>  
<span class='p'>};</span>

<span class='c1'>// every subscription gives you a token,</span>
<span class='c1'>// you should keep it if you want to unsubscribe</span>
<span class='kd'>var</span> <span class='nx'>token</span> <span class='o'>=</span> <span class='nx'>PubSub</span><span class='p'>.</span><span class='nx'>subscribe</span><span class='p'>(</span> <span class='s1'>&#39;some message&#39;</span><span class='p'>,</span> <span class='nx'>logToConsole</span> <span class='p'>);</span>

<span class='c1'>// publishing messages is also quite easy</span>
<span class='nx'>PubSub</span><span class='p'>.</span><span class='nx'>publish</span><span class='p'>(</span> <span class='s1'>&#39;some message&#39;</span><span class='p'>,</span> <span class='s1'>&#39;hello world!&#39;</span> <span class='p'>);</span>

<span class='c1'>// now let&#39;s unsubscribe from this message</span>
<span class='nx'>PubSub</span><span class='p'>.</span><span class='nx'>unsubscribe</span><span class='p'>(</span> <span class='nx'>token</span> <span class='p'>);</span>
</code></pre>
</div>
<p>So, as you can see, it&#8217;s fairly simple to work with.</p>

<p>To illustrate the difference in execution speed of working with <a href='https://developer.mozilla.org/en/JavaScript'>JavaScript</a> and JavaScript + DOM, I&#8217;ve created a <a href='http://jsperf.com/'>JSPerf.com</a> testpage, that <a href='http://jsperf.com/pubsubjs-vs-jquery-custom-events'>compares PubSubJS performance to jQuery custom events</a>. You should go check it out.</p>

<h2 id='so_should_i_use_it'>So, should I use it?</h2>

<p>No! &#8230; Well, maybe &#8230;</p>

<p>If you&#8217;re building larger web applications where you need to have loose coupling between your modules / components / widgets / whatnots, then publish/subscribe <em>can</em> be the answer you&#8217;re looking for.</p>

<p>If you happen to build larger web applications with Dojo and need publish/subscribe, then I recommend you look at the implementation that&#8217;s already IN Dojo, or get in touch with &#8220;Rebecca Murphey&#8221;:http://www.rebeccamurphey.com/ ;-)</p>

<p>Consider this: publish/subscribe is a bit like explosives. In the hands of thoughtful experts, you can expect to have a sky scraper demolished safely and in a reasonable time frame. In the hands of amateurs, working with explosives, you&#8217;ll end up with some very noisy and messy situations when you least expect it. And sure, every once in a while, even experts make mistakes.</p>

<p>&#8220;So why even write a publish/subscribe library?&#8221; you may ask, and the answer is simple: I need it, just like demolition experts need access to high grade, stable and predictable explosives.</p>

<p>Don&#8217;t say I didn&#8217;t warn you.</p>
<hr />
<ul>
<li><a href='http://code.quirkey.com/sammy/'>Sammy.js</a> also uses jQuery custom events. I am however trying to convince Aaron to use pure JavaScript publish/subscribe messaging instead.</li>

<li><a href='http://enterprisejquery.com/2010/09/creating-an-ajax-component-handling-errors-and-loading-notifications-with-publish-and-subscribe/'>Handling Errors and Loading Notifications with Publish and Subscribe</a></li>
</ul>

<p>After writing PubSubJS, I discovered that Peter Higgins has implemented <a href='http://github.com/phiggins42/bloody-jquery-plugins/blob/master/pubsub.js'>publish/subscribe for jQuery</a></p>
		
		
	</article>
</div>
		</div>
		<footer>
			&copy;Morgan Roderick, unless otherwise noted.
		</footer>
	  </div>

	  <!-- mathiasbynens.be/notes/async-analytics-snippet Change UA-XXXXX-X to be your site's ID -->
	  <script>
		var _gaq=[["_setAccount","UA-869742-1"],["_trackPageview"]];
		(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
		g.src=("https:"==location.protocol?"//ssl":"//www")+".google-analytics.com/ga.js";
		s.parentNode.insertBefore(g,s)}(document,"script"));
	  </script>
	</body>
</html>